# План по оптимизации и улучшению проекта CYOA Embeddings

 

## 2. Оптимизация производительности

### 2.1. Параллелизация загрузки текстов

-   **Проблема:** `fetch_game_text.py` обрабатывает игры последовательно. Загрузка `project.json` — это I/O-операция, которая хорошо поддается распараллеливанию.
-   **Решение:** Использовать `concurrent.futures.ThreadPoolExecutor` для одновременной загрузки `project.json` для нескольких игр. Запуск Selenium можно оставить последовательным, чтобы не перегружать систему, или выполнять его только для тех игр, где прямой метод не сработал.

### 2.2. Оптимизация переиндексации

-   **Проблема:** `indexer.py` всегда выполняет полную переиндексацию всех игр. Это неэффективно, если изменилась только одна игра.
-   **Решение:** Модифицировать `indexer.py` для поддержки инкрементальной индексации:
    1.  Добавить аргумент `--incremental` или `--since <timestamp>`.
    2.  Выбирать из БД только те игры, где `last_indexed_at` IS NULL (новые/измененные).
    3.  Загружать существующий Faiss-индекс и карту чанков.
    4.  Удалять из индекса старые векторы, относящиеся к измененным играм (по `game_id`). Это самая сложная часть, требующая `index.remove_ids()`.
    5.  Добавлять новые векторы для этих игр.
    *Примечание: Полная переиндексация проще и надежнее, поэтому эту задачу стоит выполнять, только если производительность станет реальной проблемой.*

## 3. Улучшение надежности и логирования

### 3.1. Структурированное логирование

-   **Проблема:** Логирование в `main.py` включается/выключается через константу `DEBUG_LOGGING`. Логи в других скриптах выводятся через `print()` или `tqdm.write()`.
-   **Решение:** Внедрить стандартную библиотеку `logging` во все скрипты. Настроить разные уровни логирования (INFO, WARNING, ERROR) и выводить их в консоль и/или файл. Это позволит централизованно управлять детализацией вывода.

### 3.2. Более надежная обработка ошибок в API

-   **Проблема:** В `generate_summary.py` ошибка API возвращается как строка `"API_ERROR: ..."`. Это не очень надежный способ.
-   **Решение:** Модифицировать `generate_summary_with_openrouter` так, чтобы она вызывала исключение (raise Exception) в случае ошибки. В главном потоке `process_game` оборачивать вызов в `try...except` и возвращать, например, кортеж `(pb_id, title, None, error_message)`. Это сделает обработку ошибок более явной.

## 4. Улучшения Frontend

### 4.1. Постраничная навигация для списка всех игр

-   **Проблема:** Если в базе будут тысячи игр, страница "All Games" станет очень медленной и громоздкой, так как загружает и отображает все игры сразу.
-   **Решение:**
    1.  На бэкенде (`main.py` в эндпоинте `/games`) добавить параметры `page` и `page_size` для пагинации.
    2.  На фронтенде (`static/script.js`) реализовать "бесконечную прокрутку" (infinite scroll) или кнопки "Загрузить еще", которые будут подгружать следующую порцию игр по мере необходимости.

### 4.2. Добавление фильтрации и сортировки

-   **Проблема:** Список всех игр можно только просматривать.
-   **Решение:** Добавить на фронтенд поле для текстового поиска по названию, а также фильтры (например, "Только с описанием", "Неиндексированные") и опции сортировки (по алфавиту, по дате). Соответствующие параметры должны передаваться на бэкенд.

---
